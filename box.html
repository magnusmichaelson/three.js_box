<!DOCTYPE html>
<html lang="en">
<head>
<title>datacenterVR</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<style>

html, body {
width: 100%;
height: 100%;
}
body {
background-color: #ffffff;
margin: 0;
overflow: hidden;
font-family: arial;
}
H1 {
display: inline;
}
p{
display: inline;
}
#main {
position: relative;
width: 100%;
height: 100%;
}
#ghost {
overflow-y: auto;
}
.stack-top{
z-index: 9;
}
a:link {
color: rgb(0, 10, 95);
text-decoration: none;
}
a:visited {
color: rgb(0, 10, 95);
text-decoration: none;
}
a:hover {
color: rgb(0, 10, 95);
text-decoration: none;
}
a:active {
color: rgb(0, 10, 95);
text-decoration: none;
}
.btn-group-green{
background-color: #4CAF50;
border: 1px solid green;
color: white;
padding: 10px 24px;
cursor: pointer;
width: 25%;
display: block;
}
.btn-group-grey{
background-color: #949494;
border: 1px solid rgb(80, 80, 80);
color: white;
padding: 10px 24px;
cursor: pointer;
width: 25%;
display: block;
}

</style>
</head>
<body>
    <script src="./dependencies/three.min.js"></script>
    <script src="./dependencies/PointerLockControls.js"></script>


    <div id = "main">
        <div id="3d" style="display: none">
            <div id="ghost" class="stack-top"></div>
            <div id = "lower">WASD for movement. Shift = down. Space = up. E = sprint. Slack channel : #dcse-vr</div>
            <canvas id="my_canvas" width="800" height="400"></canvas>
        </div>
        <div id="noPointerLock" style="display: none">Your browser does not support pointerLock, which is required for the 3d Datacenter to work.</div>
    </div>


<script src="./testData.js"></script>
<script>

"use strict";
//function main(spUtil){
// global variables
var camera;
var controls;
var controlsEnabled = false;
var moveForward = false;
var moveBackward = false;
var moveLeft = false;
var moveRight = false;
var moveUp = false;
var moveDown = false;
var objectInLineOfSightCurrent;
var objectInLineOfSightPrevious;
var prevTime;
var renderer;
var scene;
var serverLink;
var speed = 6;
var speedBoost = false;
var velocity;
// data from server
var ciColor = {};
var ciComment = {};
var emptyBasic = {};
var emptyToRack = {};
var hardwareBasic = {};
var hardwareError = {};
var powerIqFinalData = {};
var rackBasic = {};
var rackCartesian = {};
var rackColor = {};
var rackComment = {};
var rackDesign = {};
var rackEmpty = {};
var rackHardware = {};
var rackSysIdValid = {};
var roomName;
var roomPowerMaximum;
var roomSysid;
// colors
var defaultColorEmpty = { "red": 0.0, "green": 0.0, "blue": 0.0 };
var defaultColorUnselectedRack = { "red": 0.4, "green": 0.4, "blue": 0.4 };
var defaultColorHardRed = { "red": 1.0, "green": 0.0, "blue": 0.0 };
var defaultColorHardware = { "red": 0.8, "green": 0.8, "blue": 0.8 };
var defaultColorRack = { "red": 1.0, "green": 1.0, "blue": 1.0 };
rendererResize();
// @ts-ignore
//document.getElementById("loading").style.display = "block";
window.addEventListener("resize", rendererResize, false);
//
//
//
//
if (false) {
    // @ts-ignore
    serverLink = this;
    // @ts-ignore
    if (serverLink.data.roomSysid == null) {
        noRoomSysidGiven();
    }
    else {
        // @ts-ignore
        serverLink.data.generatingRoom = true;
        // @ts-ignore
        serverLink.server.update().then(function () {
            // @ts-ignore
            serverLink.data.generatingRoom = false;
            // @ts-ignore
            ciColor = serverLink.data.ciColor;
            // @ts-ignore
            ciComment = serverLink.data.ciComment;
            // @ts-ignore
            emptyBasic = serverLink.data.emptyBasic;
            // @ts-ignore
            emptyToRack = serverLink.data.emptyToRack;
            // @ts-ignore
            hardwareBasic = serverLink.data.hardwareBasic;
            // @ts-ignore
            hardwareError = serverLink.data.hardwareError;
            // @ts-ignore
            rackBasic = serverLink.data.rackBasic;
            // @ts-ignore
            rackCartesian = serverLink.data.rackCartesian;
            // @ts-ignore
            rackColor = serverLink.data.rackColor;
            // @ts-ignore
            rackComment = serverLink.data.rackComment;
            // @ts-ignore
            rackDesign = serverLink.data.rackDesign;
            // @ts-ignore
            rackEmpty = serverLink.data.rackEmpty;
            // @ts-ignore
            rackHardware = serverLink.data.rackHardware;
            // @ts-ignore
            rackSysIdValid = serverLink.data.rackSysIdValid;
            // @ts-ignore
            roomName = serverLink.data.roomName;
            // @ts-ignore
            roomSysid = serverLink.data.roomSysid;
            checkForPointerLock();
        });
    }
}
else {
    // fakeData() is stored in testData.js
    // @ts-ignore
    var allData = fakeData();
    ciColor = allData["ciColor"];
    ciComment = allData["ciComment"];
    emptyBasic = allData["emptyBasic"];
    emptyToRack = allData["emptyToRack"];
    hardwareBasic = allData["hardwareBasic"];
    hardwareError = allData["hardwareError"];
    rackBasic = allData["rackBasic"];
    rackCartesian = allData["rackCartesian"];
    rackColor = allData["rackColor"];
    rackComment = allData["rackComment"];
    rackDesign = allData["rackDesign"];
    rackEmpty = allData["rackEmpty"];
    rackHardware = allData["rackHardware"];
    rackSysIdValid = allData["rackSysIdValid"];
    roomName = allData["roomName"];
    roomSysid = allData["roomSysid"];
    checkForPointerLock();
}
///////////
// menus //
///////////
function mouseClick(event) {
    if (event.button == 0) {
        mouseLeftClick();
    }
    if (event.button == 1) {
        mouseMiddleClick();
    }
    if (event.button == 2) {
        mouseRightClick();
    }
}
function onScreenMenuStart() {
    var ghost;
    ghost = document.getElementById("ghost");
    if (ghost) {
        ghost.removeEventListener('click', pointerLockRequest, false);
    }
    // @ts-ignore
    document.exitPointerLock();
}
function onScreeMenuStop() {
    var ghost;
    ghost = document.getElementById("ghost");
    if (ghost) {
        while (ghost.firstChild) {
            ghost.removeChild(ghost.firstChild);
        }
        ghost.addEventListener('click', pointerLockRequest, false);
    }
}
function mouseLeftClick() {
    var hardwareSysId;
    var lowerDiv;
    var name;
    var rackSysid;
    if (objectInLineOfSightCurrent.hasOwnProperty("userData")) {
        if (objectInLineOfSightCurrent["userData"].hasOwnProperty("type")) {
            if (objectInLineOfSightCurrent["userData"]["type"] == "alm_hardware") {
                hardwareSysId = objectInLineOfSightCurrent["userData"]["hardwareSysId"];
                if (hardwareSysId) {
                    if (hardwareBasic.hasOwnProperty(hardwareSysId)) {
                        // @ts-ignore
                        lowerDiv = document.getElementById("lower");
                        lowerDiv.innerHTML = "";
                        lowerDiv.innerHTML += "Hardware: ";
                        name = hardwareBasic[hardwareSysId]["name"];
                        if (name) {
                            lowerDiv.innerHTML += name;
                        }
                        else {
                            lowerDiv.innerHTML += "CI is missing";
                        }
                    }
                }
            }
            if (objectInLineOfSightCurrent["userData"]["type"] == "u_patch_panel") {
                hardwareSysId = objectInLineOfSightCurrent["userData"]["hardwareSysId"];
                if (hardwareSysId) {
                    if (hardwareBasic.hasOwnProperty(hardwareSysId)) {
                        // @ts-ignore
                        lowerDiv = document.getElementById("lower");
                        lowerDiv.innerHTML = "";
                        lowerDiv.innerHTML += "Hardware: ";
                        lowerDiv.innerHTML += hardwareBasic[hardwareSysId]["name"];
                    }
                }
            }
            if (objectInLineOfSightCurrent["userData"]["type"] == "rack") {
                rackSysid = objectInLineOfSightCurrent["userData"]["sysid"];
                if (rackSysid) {
                    if (rackBasic.hasOwnProperty(rackSysid)) {
                        // @ts-ignore
                        lowerDiv = document.getElementById("lower");
                        lowerDiv.innerHTML = "";
                        lowerDiv.innerHTML += "Rack: ";
                        lowerDiv.innerHTML += rackBasic[rackSysid]["name"];
                    }
                }
            }
        }
    }
}
function mouseMiddleClick() {
}
function mouseRightClick() {
    var blockType;
    var button;
    var htmlElement;
    // function to add buttons
    var addButton = function (title, id, className) {
        htmlElement = document.getElementById('ghost');
        if (htmlElement) {
            button = document.createElement("BUTTON");
            button.id = id;
            button.className = className;
            button.innerHTML = title;
            htmlElement.appendChild(button);
        }
    };
    blockType = objectInLineOfSightCurrent.userData.type;
    // open rack view
    if (blockType) {
        addButton('Open Rack Visualization', 'menuOpenRackViz', 'btn-group-green');
        htmlElement = document.getElementById('menuOpenRackViz');
        if (htmlElement) {
            htmlElement.addEventListener('click', menuOpenRackViz, false);
        }
    }
    else {
        addButton('Open Rack Visualization', 'menuOpenRackViz', 'btn-group-grey');
    }
    // open servicenow page
    if (blockType == "rack" || blockType == "alm_hardware" || blockType == "u_patch_panel") {
        addButton('Open in ServiceNow', 'menuOpenServiceNow', 'btn-group-green');
        htmlElement = document.getElementById('menuOpenServiceNow');
        if (htmlElement) {
            htmlElement.addEventListener('click', menuOpenServiceNow, false);
        }
    }
    else {
        addButton('Open in ServiceNow', 'openServiceNow', 'btn-group-grey');
    }
    // nuke
    addButton('Nuke', 'nuke', 'btn-group-green');
    htmlElement = document.getElementById('nuke');
    if (htmlElement) {
        htmlElement.addEventListener('click', function () {
            scene.remove(objectInLineOfSightCurrent);
            onScreeMenuStop();
        }, false);
    }
    // cancel
    addButton('Cancel', 'cancel', 'btn-group-green');
    htmlElement = document.getElementById('cancel');
    if (htmlElement) {
        htmlElement.addEventListener('click', onScreeMenuStop, false);
    }
    onScreenMenuStart();
}
function menuOpenRackViz() {
    var hardwareSysId;
    var rackSysId;
    rackSysId = "";
    if (objectInLineOfSightCurrent.userData.type == "alm_hardware") {
        hardwareSysId = objectInLineOfSightCurrent.userData.hardwareSysId;
        rackSysId = hardwareBasic[hardwareSysId]["rack_sysid"];
    }
    if (objectInLineOfSightCurrent.userData.type == "u_patch_panel") {
        hardwareSysId = objectInLineOfSightCurrent.userData.hardwareSysId;
        rackSysId = hardwareBasic[hardwareSysId]["rack_sysid"];
    }
    if (objectInLineOfSightCurrent.userData.type == "rack") {
        rackSysId = objectInLineOfSightCurrent.userData.sysid;
    }
    if (objectInLineOfSightCurrent.userData.type == "empty") {
        rackSysId = emptyToRack[objectInLineOfSightCurrent.name];
    }
    if (rackSysId) {
        window.open("nav_to.do?uri=%2Fsp%3Fid%3Ddcscapeng_rackview%26rackSysid%3D" + rackSysId);
    }
    onScreeMenuStop();
}
function menuOpenServiceNow() {
    var hardwareSysId;
    var rackSysId;
    rackSysId = "";
    if (objectInLineOfSightCurrent.userData.type == "alm_hardware") {
        hardwareSysId = objectInLineOfSightCurrent.userData.hardwareSysId;
        window.open("nav_to.do?uri=%2Falm_hardware.do%3Fsys_id%3D" + hardwareSysId);
    }
    if (objectInLineOfSightCurrent.userData.type == "u_patch_panel") {
        hardwareSysId = objectInLineOfSightCurrent.userData.hardwareSysId;
        window.open("nav_to.do?uri=%2Fu_patch_panel.do%3Fsys_id%3D" + hardwareSysId);
    }
    if (objectInLineOfSightCurrent.userData.type == "rack") {
        rackSysId = objectInLineOfSightCurrent.userData.sysid;
        window.open("nav_to.do?uri=%2Fcmdb_ci_rack.do%3Fsys_id%3D" + rackSysId);
    }
    onScreeMenuStop();
}
function subMenuDownloadBlocks() {
    /*
    var button: HTMLElement;
    var htmlElement: HTMLElement | null;
    var ghost: HTMLElement | null;
    // clear main menu
    ghost = document.getElementById("ghost");
    if (ghost){
        while (ghost.firstChild) {
            ghost.removeChild(ghost.firstChild);
        }
        var addButton: any = function(title: string,id: string,className: string){
        htmlElement = document.getElementById('ghost');
        if (htmlElement){
            button = document.createElement("BUTTON");
            button.id = id;
            button.className = className;
            button.innerHTML = title;
            htmlElement.appendChild(button);
        }
        }
        addButton('Download scene blocks','downloadSceneBlocks','btn-group-green');
        htmlElement = document.getElementById('downloadSceneBlocks')
        if (htmlElement){
        htmlElement.addEventListener('click', function(){
            exportBlocks(sceneBlocks,"scene");
            onScreeMenuStop();
        }, false);
        }
        addButton('Download rack blocks','downloadRackBlocks','btn-group-green');
        htmlElement = document.getElementById('downloadRackBlocks')
        if (htmlElement){
        htmlElement.addEventListener('click', function(){
            exportBlocks(rackBlocks,"racks");
            onScreeMenuStop();
        }, false);
        }
        // cancel
        addButton('Cancel','cancel','btn-group-green');
        htmlElement = document.getElementById('cancel');
        if (htmlElement){
        htmlElement.addEventListener('click', onScreeMenuStop, false);
        }
    }
    */
}
///////////////////////////
// visualization control //
///////////////////////////
function rackOverlayChange() {
    var rackOverlayValue;
    // @ts-ignore
    rackOverlayValue = document.getElementById("rackOverlay").value;
    if (rackOverlayValue == "default") {
        turnRacksDefault();
    }
    if (rackOverlayValue == "yellow") {
        turnRacksYellow();
    }
    if (rackOverlayValue == "green") {
        turnRacksGreen();
    }
    changeColor();
}
function hardwareOverlay() {
    var hardwareOverlayValue;
    // @ts-ignore
    hardwareOverlayValue = document.getElementById("hardwareOverlay").value;
    if (hardwareOverlayValue == "default") {
        turnHardwareDefault();
    }
    if (hardwareOverlayValue == "pink") {
        turnHardwarePink();
    }
    if (hardwareOverlayValue == "blue") {
        turnHardwareBlue();
    }
    changeColor();
}
function turnRacksDefault() {
    Object.keys(rackSysIdValid).forEach(function (rackSysId) {
        rackColor[rackSysId] = defaultColorRack;
    });
}
function turnRacksYellow() {
    Object.keys(rackSysIdValid).forEach(function (rackSysId) {
        rackColor[rackSysId] = { "red": 1.0, "green": 1.0, "blue": 0.6 };
    });
}
function turnRacksGreen() {
    Object.keys(rackSysIdValid).forEach(function (rackSysId) {
        rackColor[rackSysId] = { "red": 0.6, "green": 1.0, "blue": 0.6 };
    });
}
function turnHardwareDefault() {
    Object.keys(ciColor).forEach(function (ciSysId) {
        ciColor[ciSysId] = defaultColorHardware;
    });
}
function turnHardwarePink() {
    Object.keys(ciColor).forEach(function (ciSysId) {
        ciColor[ciSysId] = { "red": 1.0, "green": 0.6, "blue": 0.6 };
    });
}
function turnHardwareBlue() {
    Object.keys(ciColor).forEach(function (ciSysId) {
        ciColor[ciSysId] = { "red": 0.6, "green": 0.6, "blue": 1.0 };
    });
}
/////////////////////////////////////
// recoloring objects in the scene //
/////////////////////////////////////
function changeColor() {
    var rackChosen;
    Object.keys(rackSysIdValid).forEach(function (rackSysid) {
        rackChosen = checkrackChosen(rackSysid);
        colorRack(rackSysid, rackChosen);
        rackHardware[rackSysid].forEach(function (hardwareSysid) {
            colorHardware(rackChosen, hardwareSysid);
        });
        rackEmpty[rackSysid].forEach(function (emptyId) {
            colorEmpty(rackChosen, emptyId);
        });
    });
}
function checkrackChosen(rackSysid) {
    //var environment;
    var rackChosen;
    //var rackFilterValue;
    rackChosen = true;
    /*
    // @ts-ignore
    rackFilterValue = document.getElementById('rackFilter').value;
    environment = "missing";
    if (rackDesign.hasOwnProperty(rackSysid)) {
        environment = rackDesign[rackSysid]["u_environment"];
    }
    if (rackFilterValue == 'all' || rackFilterValue == environment) {
        rackChosen = true;
    }
    return (rackChosen);
    */
}
function colorRack(rackSysid, rackChosen) {
    var color;
    var rackToColor;
    color = { "red": 0.0, "green": 0.0, "blue": 0.0 };
    color["red"] = defaultColorUnselectedRack["red"];
    color["green"] = defaultColorUnselectedRack["green"];
    color["blue"] = defaultColorUnselectedRack["blue"];
    if (rackChosen) {
        color["red"] = rackColor[rackSysid]["red"];
        color["green"] = rackColor[rackSysid]["green"];
        color["blue"] = rackColor[rackSysid]["blue"];
    }
    rackToColor = scene.getObjectByName("rack_" + rackSysid);
    if (rackToColor) {
        rackToColor.material.color.setRGB(color["red"], color["green"], color["blue"]);
    }
}
function colorHardware(rackChosen, hardwareSysid) {
    var ciSysId;
    var color;
    var hardwareFilterValue;
    var hardwareOverlayValue;
    var hardwareToColor;
    var highlightable;
    var highlightColor;
    highlightable = false;
    hardwareToColor = scene.getObjectByName("hardware_" + hardwareSysid);
    if (hardwareToColor) {
        // @ts-ignore
        //hardwareOverlayValue = document.getElementById('hardwareOverlay').value;
        // @ts-ignore
        //hardwareFilterValue = document.getElementById('hardwareFilter').value;
        // @ts-ignore
        hardwareOverlayValue = "default";
        // @ts-ignore
        hardwareFilterValue = "all";
        highlightable = false;
        color = { "red": 0.0, "green": 0.0, "blue": 0.0 };
        highlightColor = { "red": 0.0, "green": 0.0, "blue": 0.0 };
        color["red"] = defaultColorUnselectedRack["red"];
        color["green"] = defaultColorUnselectedRack["green"];
        color["blue"] = defaultColorUnselectedRack["blue"];
        highlightColor["red"] = defaultColorUnselectedRack["red"];
        highlightColor["green"] = defaultColorUnselectedRack["green"];
        highlightColor["blue"] = defaultColorUnselectedRack["blue"];
        if (rackChosen) {
            if (hardwareFilterValue == 'all' || hardwareFilterValue == hardwareBasic[hardwareSysid]["supportgroup_name"]) {
                color["red"] = defaultColorHardware["red"];
                color["green"] = defaultColorHardware["green"];
                color["blue"] = defaultColorHardware["blue"];
                highlightColor["red"] = defaultColorHardware["red"];
                highlightColor["green"] = defaultColorHardware["green"];
                highlightColor["blue"] = defaultColorHardware["blue"];
                if (hardwareError[hardwareSysid]) {
                    if (hardwareOverlayValue == 'default') {
                        color["red"] = defaultColorHardRed["red"];
                        color["green"] = defaultColorHardRed["green"];
                        color["blue"] = defaultColorHardRed["blue"];
                        highlightColor["red"] = defaultColorHardRed["red"];
                        highlightColor["green"] = defaultColorHardRed["green"];
                        highlightColor["blue"] = defaultColorHardRed["blue"];
                    }
                    else {
                        color["red"] = defaultColorUnselectedRack["red"];
                        color["green"] = defaultColorUnselectedRack["green"];
                        color["blue"] = defaultColorUnselectedRack["blue"];
                        highlightColor["red"] = defaultColorUnselectedRack["red"];
                        highlightColor["green"] = defaultColorUnselectedRack["green"];
                        highlightColor["blue"] = defaultColorUnselectedRack["blue"];
                    }
                }
                ciSysId = hardwareToColor.userData.ciSysId;
                if (ciSysId) {
                    if (ciColor.hasOwnProperty(ciSysId)) {
                        color["red"] = ciColor[ciSysId]["red"];
                        color["green"] = ciColor[ciSysId]["green"];
                        color["blue"] = ciColor[ciSysId]["blue"];
                        highlightColor["red"] = ciColor[ciSysId]["red"] * 0.6;
                        highlightColor["green"] = ciColor[ciSysId]["green"] * 0.6;
                        highlightColor["blue"] = ciColor[ciSysId]["blue"] * 0.6;
                        highlightable = true;
                    }
                }
            }
        }
        else {
            color["red"] = defaultColorUnselectedRack["red"];
            color["green"] = defaultColorUnselectedRack["green"];
            color["blue"] = defaultColorUnselectedRack["blue"];
            highlightColor["red"] = defaultColorUnselectedRack["red"];
            highlightColor["green"] = defaultColorUnselectedRack["green"];
            highlightColor["blue"] = defaultColorUnselectedRack["blue"];
        }
        hardwareToColor.material.color.setRGB(color["red"], color["green"], color["blue"]);
        hardwareToColor.userData.colorRed = color["red"];
        hardwareToColor.userData.colorGreen = color["green"];
        hardwareToColor.userData.colorBlue = color["blue"];
        hardwareToColor.userData.highlightable = highlightable;
        hardwareToColor.userData.highlightRed = highlightColor["red"];
        hardwareToColor.userData.highlightGreen = highlightColor["green"];
        hardwareToColor.userData.highlightBlue = highlightColor["blue"];
    }
}
function colorEmpty(rackChosen, emptyId) {
    var color;
    var emptyToColor;
    color = { "red": 0.0, "green": 0.0, "blue": 0.0 };
    color["red"] = defaultColorUnselectedRack["red"];
    color["green"] = defaultColorUnselectedRack["green"];
    color["blue"] = defaultColorUnselectedRack["blue"];
    if (rackChosen) {
        color["red"] = defaultColorEmpty["red"];
        color["green"] = defaultColorEmpty["green"];
        color["blue"] = defaultColorEmpty["blue"];
    }
    emptyToColor = scene.getObjectByName(emptyId);
    if (emptyToColor) {
        emptyToColor.material.color.setRGB(color["red"], color["green"], color["blue"]);
    }
}
////////////////////////////////////
// visualization color generation //
////////////////////////////////////
/**
 * @function spectrumGreenRed
 * @description take a number and returns color data from green to red
 * @param {number} decimal - the number to be converted into color
 */
function spectrumGreenRed(numerator, denominator) {
    var color = {
        "red": 1,
        "green": 1,
        "blue": 1
    };
    var decimal;
    var saturation;
    saturation = 0.5;
    decimal = numerator / denominator;
    if (denominator == 0) {
        decimal = 1;
    }
    // green to yellow
    if (decimal < 0.5) {
        color["red"] = (1 - saturation) + (decimal / 0.5 * saturation);
        color["green"] = 1;
        color["blue"] = (1 - saturation);
    }
    // yellow to red
    if (decimal >= 0.5) {
        color["red"] = 1;
        color["green"] = (1 - saturation) + (saturation - ((decimal - 0.5) / 0.5) * saturation);
        color["blue"] = (1 - saturation);
    }
    // max or over, hard red
    if (decimal >= 1.0) {
        color = {
            "red": 1,
            "green": 0.2,
            "blue": 0.2
        };
    }
    return (color);
}
/**
     * @function spectrumBluePink
     * @description take a number and returns color data from blue to pink
     * @param {number} decimal - the number to be converted into color
 */
function spectrumBluePink(numerator, denominator) {
    var color = {
        "red": 1,
        "green": 1,
        "blue": 1
    };
    var decimal;
    var saturation;
    saturation = 0.5;
    decimal = numerator / denominator;
    if (denominator == 0) {
        decimal = 1;
    }
    if (decimal < 0.0) {
        decimal = 0.0;
    }
    color["red"] = (1 - saturation) + (decimal * saturation);
    color["green"] = (1 - saturation);
    color["blue"] = 1;
    return (color);
}
///////////////
// animation //
///////////////
/**
 * @function animate
 * @description the animation loop
 */
function animate() {
    var closestDistance;
    var colorBlue;
    var colorGreen;
    var colorRed;
    var lineOfSightResult;
    requestAnimationFrame(animate);
    lineOfSightResult = animationFindLineOfSight();
    closestDistance = lineOfSightResult["closestDistance"];
    objectInLineOfSightCurrent = lineOfSightResult["closest"];
    if (closestDistance != -1) {
        if (objectInLineOfSightCurrent != objectInLineOfSightPrevious) {
            if (objectInLineOfSightCurrent.userData.highlightable) {
                colorBlue = objectInLineOfSightCurrent.userData.highlightBlue;
                colorGreen = objectInLineOfSightCurrent.userData.highlightGreen;
                colorRed = objectInLineOfSightCurrent.userData.highlightRed;
                objectInLineOfSightCurrent.material.color.setRGB(colorRed, colorGreen, colorBlue);
            }
        }
    }
    if (objectInLineOfSightCurrent != objectInLineOfSightPrevious) {
        if (objectInLineOfSightPrevious) {
            if (objectInLineOfSightPrevious.userData.highlightable) {
                colorBlue = objectInLineOfSightPrevious.userData.colorBlue;
                colorGreen = objectInLineOfSightPrevious.userData.colorGreen;
                colorRed = objectInLineOfSightPrevious.userData.colorRed;
                objectInLineOfSightPrevious.material.color.setRGB(colorRed, colorGreen, colorBlue);
            }
        }
        objectInLineOfSightPrevious = objectInLineOfSightCurrent;
    }
    if (controlsEnabled) {
        var time = performance.now();
        var delta = (time - prevTime);
        // @ts-ignore
        //document.getElementById("fps").innerText = "FPS: " + Math.floor(1000 / delta);
        if (speedBoost) {
            delta = delta * 5 / 1000;
        }
        else {
            delta = delta / 1000;
        }
        velocity.x = 0;
        velocity.z = 0;
        if (moveForward)
            velocity.z = -speed * delta;
        if (moveBackward)
            velocity.z = speed * delta;
        if (moveLeft)
            velocity.x = -speed * delta;
        if (moveRight)
            velocity.x = speed * delta;
        controls.getObject().translateX(velocity.x);
        controls.getObject().translateZ(velocity.z);
        if (moveDown) {
            controls.getObject().position.y -= (speed * delta);
        }
        if (moveUp) {
            controls.getObject().position.y += (speed * delta);
        }
        prevTime = time;
    }
    renderer.render(scene, camera);
}
function animationFindLineOfSight() {
    var cameraDirection;
    var cameraPostion;
    var closest;
    var closestDistance;
    var intersects;
    // @ts-ignore
    var raycaster = new THREE.Raycaster();
    // @ts-ignore
    cameraPostion = new THREE.Vector3();
    // @ts-ignore
    cameraDirection = new THREE.Vector3();
    closestDistance = -1;
    camera.getWorldPosition(cameraPostion);
    camera.getWorldDirection(cameraDirection);
    raycaster.set(cameraPostion, cameraDirection);
    var intersects = raycaster.intersectObjects(scene.children);
    if (intersects.length > 0) {
        for (var i = 0; i < intersects.length; i++) {
            if (closestDistance == -1) {
                closestDistance = intersects[i].distance;
                closest = intersects[i].object;
            }
            else {
                if (intersects[i].distance < closestDistance) {
                    closestDistance = intersects[i].distance;
                    closest = intersects[i].object;
                }
            }
        }
    }
    return ({
        closest: closest,
        closestDistance: closestDistance
    });
}
//////////////////
// default page //
//////////////////
/**
 * @function noRoomSysidGiven
 * @description gives an explanation of how a rack sys_id needs to given as a url parameter
 */
function noRoomSysidGiven() {
    var dropDown;
    var optionElement;
    var sortedNames = [];
    var roomOptions = {};
    // @ts-ignore
    dropDown = document.getElementById('roomDropDown');
    dropDown.addEventListener('change', roomFromDropdown, false);
    // @ts-ignore
    //document.getElementById("start").style.display = "none";
    // @ts-ignore
    //document.getElementById("loading").style.display = "none";
    // @ts-ignore
    //document.getElementById("roomSelect").style.display = "block";
    // @ts-ignore
    serverLink.data.getRooms = true;
    // @ts-ignore
    serverLink.server.update().then(function () {
        // @ts-ignore
        serverLink.data.getRooms = false;
        // @ts-ignore
        roomOptions = serverLink.data.roomOptions;
        sortedNames = Object.keys(roomOptions);
        sortedNames.sort();
        sortedNames.forEach(function (roomName) {
            optionElement = document.createElement('option');
            optionElement.text = roomName;
            optionElement.value = roomOptions[roomName];
            dropDown.add(optionElement);
        });
    });
}
function roomFromDropdown() {
    var dropDown;
    // @ts-ignore
    dropDown = document.getElementById("roomDropDown");
    if (dropDown.value !== "default") {
        window.open("nav_to.do?uri=%2Fsp%2F%3Fid%3Ddatacenter_vr%26sysid%3D" + dropDown.value);
    }
}
////////////
// set up //
////////////
/**
 * @function rackEnvironmentFilter
 * @description fill the environment dropdown
 */
function rackEnvironmentFilter(rackDesign) {
    /*
    var optionElement;
    var rackEnvironmentList = [];
    var selectElement;
    selectElement = document.getElementById('rackFilter');
    Object.keys(rackDesign).forEach(function (rackSysid) {
        if (rackEnvironmentList.indexOf(rackDesign[rackSysid]['u_environment']) < 0) {
            rackEnvironmentList.push(rackDesign[rackSysid]['u_environment']);
        }
    });
    rackEnvironmentList.sort();
    rackEnvironmentList.forEach(function (group) {
        optionElement = document.createElement('option');
        optionElement.text = group;
        optionElement.value = group;
        selectElement.add(optionElement);
    });
    */
}
/**
 * @function hardwareSupportGroupFilter
 * @description fill the support group dropdown
 */
function hardwareSupportGroupFilter(rackHardware) {
    /*
    var optionElement;
    var selectElement;
    var supportGroup;
    var supportGroupList = [];
    selectElement = document.getElementById('hardwareFilter');
    Object.keys(rackHardware).forEach(function (rackSysid) {
        rackHardware[rackSysid].forEach(function (hardwareSysid) {
            supportGroup = hardwareBasic[hardwareSysid]['supportgroup_name'];
            if (supportGroup != null) {
                if (supportGroupList.indexOf(supportGroup) < 0) {
                    supportGroupList.push(supportGroup);
                }
            }
        });
    });
    supportGroupList.sort();
    supportGroupList.forEach(function (group) {
        optionElement = document.createElement('option');
        optionElement.text = group;
        optionElement.value = group;
        selectElement.add(optionElement);
    });
    */
}
function checkForPointerLock() {
    var havePointerLock;
    havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;
    if (havePointerLock) {
        document.addEventListener('pointerlockchange', pointerlockchange, false);
        document.addEventListener('mozpointerlockchange', pointerlockchange, false);
        document.addEventListener('webkitpointerlockchange', pointerlockchange, false);
        generateScene();
        changeColor();
        animate();
    }
    else {
        console.log('Your browser doesn\'t seem to support Pointer Lock API');
    }
}
/**
 * @function generateScene
 * @description generate everything in the 3D scene
 */
function generateScene() {
    // @ts-ignore
    //document.getElementById("start").style.display = "none";
    // @ts-ignore
    //document.getElementById("loading").style.display = "none";
    // @ts-ignore
    document.getElementById("3d").style.display = "block";
    addEventListeners();
    addThreeJsContent();
    rackEnvironmentFilter(rackDesign);
    hardwareSupportGroupFilter(rackHardware);
    buildRacks();
    rendererResize();
}
function buildRacks() {
    Object.keys(rackSysIdValid).forEach(function (rackSysid) {
        if (rackCartesian.hasOwnProperty(rackSysid)) {
            addCartesianRack(rackSysid);
        }
    });
}
function addCartesianRack(rackSysid) {
    var blockName;
    var blockSysid;
    var color;
    var highlightable;
    var lineColor;
    var type;
    var xCenter;
    var xSize;
    var yCenter;
    var ySize;
    var zCenter;
    var zSize;
    blockName = "rack_" + rackSysid;
    blockSysid = rackSysid;
    color = defaultColorRack;
    highlightable = false;
    lineColor = { "red": 0.3, "green": 0.3, "blue": 0.3 };
    xCenter = rackCartesian[rackSysid]["u_x_center"];
    xSize = rackCartesian[rackSysid]["u_x_size"];
    yCenter = rackCartesian[rackSysid]["u_y_center"];
    ySize = rackCartesian[rackSysid]["u_y_size"];
    zCenter = rackCartesian[rackSysid]["u_z_center"];
    zSize = rackCartesian[rackSysid]["u_z_size"];
    type = "rack";
    addCuboid(blockName, blockSysid, color, highlightable, type, lineColor, xCenter, xSize, yCenter, ySize, zCenter, zSize);
    addRackObjects(rackSysid);
    addRackEmptySlots(rackSysid, rackEmpty, emptyBasic);
}
function addRackObjects(rackSysid) {
    var ciSysId;
    var highlightable;
    var objectData;
    var plane;
    var planeHeight;
    var planeWidth;
    var planeZRotation;
    var rackBase;
    var unitHeight;
    var xCenter;
    var yCenter;
    var zCenter;
    unitHeight = 0.0445;
    rackHardware[rackSysid].forEach(function (hardwareSysid) {
        highlightable = false;
        if (hardwareBasic[hardwareSysid].hasOwnProperty("ci_sysid")) {
            ciSysId = hardwareBasic[hardwareSysid]["ci_sysid"];
            if (ciSysId) {
                if (ciColor.hasOwnProperty(ciSysId)) {
                    highlightable = true;
                }
            }
        }
        xCenter = 0;
        yCenter = 0;
        zCenter = 0;
        planeZRotation = 0;
        if (rackCartesian[rackSysid]["u_rotation"] % 2 == 0) {
            planeZRotation = 1.570796;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 0) {
            xCenter = rackCartesian[rackSysid]["u_x_center"];
            yCenter = rackCartesian[rackSysid]["u_y_center"] - (rackCartesian[rackSysid]["u_y_size"] * 0.5) - 0.006;
            planeWidth = rackCartesian[rackSysid]["u_x_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 1) {
            xCenter = rackCartesian[rackSysid]["u_x_center"] + (rackCartesian[rackSysid]["u_x_size"] * 0.5) + 0.006;
            yCenter = rackCartesian[rackSysid]["u_y_center"];
            planeWidth = rackCartesian[rackSysid]["u_y_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 2) {
            xCenter = rackCartesian[rackSysid]["u_x_center"];
            yCenter = rackCartesian[rackSysid]["u_y_center"] + (rackCartesian[rackSysid]["u_y_size"] * 0.5) + 0.006;
            planeWidth = rackCartesian[rackSysid]["u_x_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 3) {
            xCenter = rackCartesian[rackSysid]["u_x_center"] - (rackCartesian[rackSysid]["u_x_size"] * 0.5) - 0.006;
            yCenter = rackCartesian[rackSysid]["u_y_center"];
            planeWidth = rackCartesian[rackSysid]["u_y_size"] * 0.9;
        }
        rackBase = rackCartesian[rackSysid]["u_z_center"] - (rackCartesian[rackSysid]["u_z_size"] / 2);
        zCenter = rackBase + rackCartesian[rackSysid]["u_z_unit_start"] + ((hardwareBasic[hardwareSysid]["racku"] - 1) * unitHeight) + (hardwareBasic[hardwareSysid]["model_rackunits"] * unitHeight * 0.5);
        planeHeight = (hardwareBasic[hardwareSysid]["model_rackunits"] * unitHeight) - 0.004;
        objectData = {
            ciSysId: ciSysId,
            colorRed: 1,
            colorGreen: 1,
            colorBlue: 1,
            hardwareSysId: hardwareSysid,
            highlightable: highlightable,
            highlightRed: 1,
            highlightGreen: 1,
            highlightBlue: 1,
            name: "hardware_" + hardwareSysid,
            type: hardwareBasic[hardwareSysid]["type"]
        };
        plane = {
            planeHeight: planeHeight,
            planeWidth: planeWidth,
            planeZRotation: planeZRotation,
            xCenter: xCenter,
            yCenter: yCenter,
            zCenter: zCenter
        };
        addPlane(objectData, plane);
    });
}
function addRackEmptySlots(rackSysid, rackEmpty, emptyBasic) {
    var objectData;
    var plane;
    var planeHeight;
    var planeWidth;
    var planeZRotation;
    var rackBase;
    var unitHeight;
    var xCenter;
    var yCenter;
    var zCenter;
    unitHeight = 0.0445;
    rackEmpty[rackSysid].forEach(function (emptyName) {
        xCenter = 0;
        yCenter = 0;
        zCenter = 0;
        planeWidth = 1;
        planeHeight = 1;
        planeZRotation = 0;
        if (rackCartesian[rackSysid]["u_rotation"] % 2 == 0) {
            planeZRotation = 1.570796;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 0) {
            xCenter = rackCartesian[rackSysid]["u_x_center"];
            yCenter = rackCartesian[rackSysid]["u_y_center"] - (rackCartesian[rackSysid]["u_y_size"] * 0.5) - 0.006;
            planeWidth = rackCartesian[rackSysid]["u_x_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 1) {
            xCenter = rackCartesian[rackSysid]["u_x_center"] + (rackCartesian[rackSysid]["u_x_size"] * 0.5) + 0.006;
            yCenter = rackCartesian[rackSysid]["u_y_center"];
            planeWidth = rackCartesian[rackSysid]["u_y_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 2) {
            xCenter = rackCartesian[rackSysid]["u_x_center"];
            yCenter = rackCartesian[rackSysid]["u_y_center"] + (rackCartesian[rackSysid]["u_y_size"] * 0.5) + 0.006;
            planeWidth = rackCartesian[rackSysid]["u_x_size"] * 0.9;
        }
        if (rackCartesian[rackSysid]["u_rotation"] == 3) {
            xCenter = rackCartesian[rackSysid]["u_x_center"] - (rackCartesian[rackSysid]["u_x_size"] * 0.5) - 0.006;
            yCenter = rackCartesian[rackSysid]["u_y_center"];
            planeWidth = rackCartesian[rackSysid]["u_y_size"] * 0.9;
        }
        rackBase = rackCartesian[rackSysid]["u_z_center"] - (rackCartesian[rackSysid]["u_z_size"] / 2);
        zCenter = rackBase + rackCartesian[rackSysid]["u_z_unit_start"] + ((emptyBasic[emptyName] - 1) * unitHeight) + (unitHeight * 0.5);
        planeHeight = unitHeight - 0.004;
        objectData = {
            ciSysId: null,
            colorRed: 1,
            colorGreen: 1,
            colorBlue: 1,
            hardwareSysId: null,
            highlightable: false,
            highlightRed: 1,
            highlightGreen: 1,
            highlightBlue: 1,
            name: emptyName,
            type: "empty"
        };
        plane = {
            planeHeight: planeHeight,
            planeWidth: planeWidth,
            planeZRotation: planeZRotation,
            xCenter: xCenter,
            yCenter: yCenter,
            zCenter: zCenter
        };
        addPlane(objectData, plane);
    });
}
function addPlane(objectData, plane) {
    var geometry;
    var material;
    var mesh;
    // @ts-ignore
    geometry = new THREE.PlaneGeometry(plane["planeWidth"], plane["planeHeight"]);
    // @ts-ignore
    material = new THREE.MeshStandardMaterial({ side: THREE.DoubleSide });
    // @ts-ignore
    material.color.setRGB(objectData["colorRed"], objectData["colorGreen"], objectData["colorBlue"]);
    // @ts-ignore
    mesh = new THREE.Mesh(geometry, material);
    // @ts-ignore
    mesh.position.x = plane["yCenter"];
    // @ts-ignore
    mesh.position.y = plane["zCenter"];
    // @ts-ignore
    mesh.position.z = plane["xCenter"];
    // @ts-ignore
    mesh.rotation.y = plane["planeZRotation"];
    // @ts-ignore
    mesh.name = objectData["name"];
    // @ts-ignore
    mesh.userData.ciSysId = objectData["ciSysId"];
    mesh.userData.colorRed = objectData["colorRed"];
    mesh.userData.colorGreen = objectData["colorGreen"];
    mesh.userData.colorBlue = objectData["colorBlue"];
    mesh.userData.hardwareSysId = objectData["hardwareSysId"];
    mesh.userData.highlightable = objectData["highlightable"];
    mesh.userData.highlightRed = objectData["highlightRed"];
    mesh.userData.highlightGreen = objectData["highlightGreen"];
    mesh.userData.highlightBlue = objectData["highlightBlue"];
    mesh.userData.type = objectData["type"];
    // @ts-ignore
    scene.add(mesh);
}
function addCuboid(blockName, blockSysid, color, highlightable, type, lineColor, xCenter, xSize, yCenter, ySize, zCenter, zSize) {
    var edges;
    var geometry;
    var line;
    var material;
    var mesh;
    // @ts-ignore
    //geometry = new THREE.BoxGeometry(xSize,ySize,zSize);
    geometry = new THREE.BoxGeometry(ySize, zSize, xSize);
    // @ts-ignore
    material = new THREE.MeshStandardMaterial();
    // @ts-ignore
    material.color.setRGB(color["red"], color["green"], color["blue"]);
    // @ts-ignore
    mesh = new THREE.Mesh(geometry, material);
    // @ts-ignore
    mesh.position.x = yCenter;
    // @ts-ignore
    mesh.position.y = zCenter;
    // @ts-ignore
    mesh.position.z = xCenter;
    // @ts-ignore
    mesh.name = blockName;
    // @ts-ignore
    mesh.userData.highlightable = highlightable;
    // @ts-ignore
    mesh.userData.sysid = blockSysid;
    // @ts-ignore
    mesh.userData.type = type;
    // @ts-ignore
    scene.add(mesh);
    // @ts-ignore
    edges = new THREE.EdgesGeometry(geometry);
    // @ts-ignore
    material = new THREE.LineBasicMaterial();
    // @ts-ignore
    material.color.setRGB(lineColor["red"], lineColor["green"], lineColor["blue"]);
    // @ts-ignore
    line = new THREE.LineSegments(edges, material);
    // @ts-ignore
    mesh.add(line);
}
function addThreeJsContent() {
    var cameraPositionX = -4.0;
    var cameraPositionY = 1.9;
    var cameraPositionZ = -4.0;
    var cameraRotationX = 3.141;
    var cameraRotationY = -0.785;
    var cameraRotationZ = 3.141;
    var crosshair;
    var geometry;
    var light;
    var material;
    // @ts-ignore
    velocity = new THREE.Vector3();
    // @ts-ignore
    scene = new THREE.Scene();
    // @ts-ignore
    light = new THREE.AmbientLight(0xffffff);
    scene.add(light);
    // @ts-ignore
    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.01, 1000);
    // @ts-ignore
    controls = new THREE.PointerLockControls(camera, document.body);
    controls.getObject().position.set(cameraPositionX, cameraPositionY, cameraPositionZ);
    controls.getObject().rotation.set(cameraRotationX, cameraRotationY, cameraRotationZ);
    scene.add(camera);
    // crosshair
    // @ts-ignore
    geometry = new THREE.Geometry();
    // @ts-ignore
    geometry.vertices.push(new THREE.Vector3(0, 0.001, -0.1));
    // @ts-ignore
    geometry.vertices.push(new THREE.Vector3(0, -0.001, -0.1));
    // @ts-ignore
    geometry.vertices.push(new THREE.Vector3(0.001, 0, -0.1));
    // @ts-ignore
    geometry.vertices.push(new THREE.Vector3(-0.001, 0, -0.1));
    // @ts-ignore
    material = new THREE.LineBasicMaterial({ color: 0x000000 });
    // @ts-ignore
    crosshair = new THREE.LineSegments(geometry, material);
    camera.add(crosshair);
    // @ts-ignore
    renderer = new THREE.WebGLRenderer({ antialias: true, canvas: document.getElementById('my_canvas') });
    renderer.setClearColor(0xf0f3f4);
}
function addEventListeners() {
    // @ts-ignore
    //document.getElementById('rackOverlay').addEventListener('change', rackOverlayChange, false);
    // @ts-ignore
   //document.getElementById('rackFilter').addEventListener('change', changeColor, false);
    // @ts-ignore
    //document.getElementById('hardwareOverlay').addEventListener('change', hardwareOverlay, false);
    // @ts-ignore
    //document.getElementById('hardwareFilter').addEventListener('change', changeColor, false);
    // @ts-ignore
    document.getElementById('ghost').addEventListener('click', pointerLockRequest, false);
    // @ts-ignore
    //document.getElementById("speed").addEventListener("change", function () {
    //    // @ts-ignore
    //    speed = document.getElementById("speed").value;
    //}, false);
    document.addEventListener('keydown', onKeyDown, false);
    document.addEventListener('keyup', onKeyUp, false);
}
/**
 * @function pointerLockRequest
 * @description attempts to lock the mouse pointer when the page is clicked
 */
function pointerLockRequest() {
    var element = document.body;
    // @ts-ignore
    element.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;
    // @ts-ignore
    element.requestPointerLock();
}
/**
 * @function pointerlockchange
 * @description actions to take when the pointer is locked
 */
function pointerlockchange() {
    var element = document.body;
    // @ts-ignore
    if (document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element) {
        controlsEnabled = true;
        moveForward = false;
        moveBackward = false;
        moveLeft = false;
        moveRight = false;
        moveUp = false;
        moveDown = false;
        prevTime = performance.now();
        document.addEventListener('click', mouseClick, false);
    }
    else {
        document.removeEventListener('click', mouseClick, false);
        controlsEnabled = false;
    }
}
/**
 * @function onKeyDown
 * @description associate actions with key presses
 */
function onKeyDown(event) {
    switch (event.keyCode) {
        case 38: // up
        case 87: // w
            moveForward = true;
            break;
        case 37: // left
        case 65: // a
            moveLeft = true;
            break;
        case 40: // down
        case 83: // s
            moveBackward = true;
            break;
        case 39: // right
        case 68: // d
            moveRight = true;
            break;
        case 16: // left shift
            moveDown = true;
            break;
        case 32: // space
            moveUp = true;
            break;
        case 69: // e
            speedBoost = true;
            break;
        case 80: // p
            //cameraPosRot();
            break;
    }
}
;
/**
 * @function onKeyUp
 * @description  associate actions with key releases
 */
function onKeyUp(event) {
    switch (event.keyCode) {
        case 38: // up
        case 87: // w
            moveForward = false;
            break;
        case 37: // left
        case 65: // a
            moveLeft = false;
            break;
        case 40: // down
        case 83: // s
            moveBackward = false;
            break;
        case 39: // right
        case 68: // d
            moveRight = false;
            break;
        case 16: // left shift
            moveDown = false;
            break;
        case 32: // space
            moveUp = false;
            break;
        case 69: // e
            speedBoost = false;
            break;
    }
}
/**
 * @function rendererResize
 * @description resizes the renderer when the page is resized
 */
function rendererResize() {
    var canvasHeight;
    var canvasWidth;
    var centerHeight;
    var divElement;
    var left;
    var lowerHeight;
    var pagewidth;
    var pageheight;
    var top;
    var topHeight;
    pagewidth = window.innerWidth;
    pageheight = window.innerHeight;
    canvasWidth = pagewidth - 16;
    canvasHeight = pageheight - 16;
    topHeight = 90;
    lowerHeight = 20;
    centerHeight = canvasHeight - topHeight - lowerHeight;
    // center divs
    // @ts-ignore
    divElement = document.getElementById("my_canvas");
    divElement.style.position = 'absolute';
    divElement.style.left = "0px";
    divElement.style.top = topHeight + "px";
    divElement.style.width = canvasWidth + "px";
    divElement.style.height = centerHeight + "px";
    // @ts-ignore
    divElement = document.getElementById("ghost");
    divElement.style.position = 'absolute';
    divElement.style.left = "0px";
    divElement.style.top = topHeight + "px";
    divElement.style.width = canvasWidth + "px";
    divElement.style.height = centerHeight + "px";
    // lower div
    // @ts-ignore
    divElement = document.getElementById("lower");
    divElement.style.position = 'absolute';
    divElement.style.left = "0px";
    divElement.style.top = topHeight + centerHeight + "px";
    divElement.style.width = canvasWidth + "px";
    divElement.style.height = lowerHeight + "px";
    // @ts-ignore
    //divElement = document.getElementById("loading");
    left = (pagewidth / 2) - 60;
    top = (pageheight / 2) - 60;
    divElement.style.position = 'absolute';
    divElement.style.left = left + "px";
    divElement.style.top = top + "px";
    divElement.style.width = "120px";
    divElement.style.height = "120px";
    if (camera) {
        camera.aspect = canvasWidth / centerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(canvasWidth, centerHeight);
    }
}
//}


</script>
</body>
</html>
